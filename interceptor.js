'use strict';

function Interceptor() {
    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key]
    }

    var _geo = args
    var _api = 'https://ipinfo.io'
    var _bot = false
    var _identify = true

    function identifyUserGeo(api, geo) {
        $.getJSON(api, function (data) {
            _bot = checkBot(String(data.ip))
            if (!_bot) {
                var necessaryList = _geo.filter(function (geo) {
                    return geo === data.country
                })
            } else {
                _identify = false
            }
            necessaryList.length && _identify === true ? _identify = true : _identify = false
            addOverlayImage(_identify)
        });
    }

    function checkBot(ip) {
        var _ip = ip
        var searchResult = false
        var blockedList = ["31.13.24.1/24", "31.13.64.1/24", "45.64.40.1/24", "66.220.144.1/24", "66.220.152.1/24", "66.220.159.1/24", "69.63.176.1/24", "69.171.224.1/24", "74.119.76.1/24", "103.4.96.1/24", "129.134.0.1/24", "157.240.0.1/24", "157.240.0.1/24", "173.252.64.1/24", "179.60.192.1/24", "66.220.144.1/24", "66.220.152.1/24", "66.220.159.1/24", "69.63.176.1/24", "69.171.224.1/24", "74.119.76.1/24", "103.4.96.1/24", "129.134.0.1/24", "157.240.0.1/24", "157.240.0.1/24", "173.252.64.1/24", "179.60.192.1/24", "66.220.144.1/24", "66.220.152.1/24", "66.220.159.1/24", "69.63.176.1/24", "69.171.224.1/24", "74.119.76.1/24", "103.4.96.1/24", "129.134.0.1/24", "157.240.0.1/24", "157.240.0.1/24", "173.252.64.1/24", "179.60.192.1/24", "185.60.216.1/24", "158.255.7.67", "54.191.244.0-54.191.244.255", "54.69.76.0-54.69.76.255", "62.24.181.0-62.24.181.255", "64.74.215.0-64.74.215.255", "66.102.6.0-66.102.9.255", "66.220.144.0-66.220.159.255", "66.249.85.0-66.249.93.255", "85.17.59.0-85.17.59.255", "173.252.64.0-173.252.127.255", "173.252.120.0-173.252.120.255", "199.201.64.2-199.201.64.255", "185.20.4.0-185.20.5.255", "31.13.24.1-31.13.31.254", "31.13.64.1-31.13.127.254", "45.64.40.1-45.64.43.254", "66.220.144.1-66.220.151.254", "66.220.152.1-66.220.159.254", "66.220.159.1-66.220.159.254", "69.63.176.1-69.63.176.254", "69.171.224.1-69.171.255.254", "74.119.76.1-74.119.79.254", "103.4.96.1-103.4.99.254", "129.134.0.1-129.134.255.254", "157.240.0.1-157.240.0.254", "157.240.0.1-157.240.255.254", "173.252.64.1-173.252.127.254", "179.60.192.1-179.60.195.254", "185.60.216.1-185.60.219.254", "91.140.74.108", "188.170.196.177", "217.64.113.230", "158.255.7.67", "79.234.150.31", "93.71.143.12", "185.163.156.10", "109.172.58.180", "185.22.67.83", "93.88.42.176", "69.92.212.38", "91.213.233.197", "31.13.24.1/24", "31.13.64.1/24", "45.64.40.1/24", "66.220.144.1/24", "66.220.152.1/24", "66.220.159.1/24", "69.63.176.1/24", "69.171.224.1/24", "74.119.76.1/24", "103.4.96.1/24", "129.134.0.1/24", "157.240.0.1/24", "157.240.0.1/24", "173.252.64.1/24", "179.60.192.1/24", "185.60.216.1/24", "54.173.117.182", "54.91.58.163", "34.230.67.24", "67.205.161.19", "185.22.67.83", "34.226.200.244", "173.252.84.89", "173.252.92.116", "173.252.98.83", "66.220.151.210", "173.252.92.118", "158.255.7.67", "31.13.113.196", "31.13.114.51", "69.63.188.197", "31.13.113.78", "31.13.113.82", "31.13.113.91", "217.64.113.230", "79.234.150.31", "158.255.7.67", "91.140.74.108", "93.71.143.12", "185.163.156.10", "109.172.58.180", "188.170.196.177", "109.172.58.180", "31.23.25.253", "109.127.8.178", "107.170.1.1/24", "162.243.146.65", "54.248.153.153", "176.212.234.213", "212.3.195.55", "176.223.103.250", "158.255.5.195", "185.22.67.83", "125.16.216.9", "162.243.167.218", "92.99.165.107", "93.171.3.153", "139.184.223.161", "109.228.19.159", "91.227.68.154", "31.173.165.111", "163.172.4.153", "206.225.80.193", "216.55.138.168", "176.58.192.160", "176.55.137.205", "91.213.233.197", "185.148.37.32", "83.149.46.183", "46.175.103.234", "194.154.70.205", "217.118.78.120", "91.192.67.249", "95.46.80.120", "193.144.81.195", "217.118.78.107", "95.46.88.52", "85.115.248.2", "95.46.84.195", "176.221.34.225", "31.173.81.178", "5.164.100.122", "217.118.83.244", "188.243.234.176", "84.51.57.18", "5.56.60.88", "95.22.61.202", "199.30.228.134", "85.26.235.14", "93.84.114.149"];
        var searchList = blockedList.filter(function (ip) {
            return ip !== _ip
        })
        searchList.length !== blockedList.length ? (searchResult = true) : (searchResult = false)
        return searchResult
    }

    function addOverlayImage(_identify) {
        if (_identify) {
            var wrapper = document.getElementById('js-wrapper')
            if(wrapper) {wrapper.classList.add('overlay')}
            return true
        } else {
            return false
        }
    }

    function init() {
        if (_geo.length !== 0 && typeof _geo !== undefined) {
            identifyUserGeo(_api, _geo)
            return true
        } else {
            throw new Error('You must specify the location in the created instance')
            return false;
        }
    }

    return Object.freeze({
        init
    })
}

var interceptor = Interceptor("RU", "IT");
interceptor.init();